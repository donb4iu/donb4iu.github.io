<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <title>notes - Kalaxy2 Cluster</title>
    <meta name="description" content="Arm64/Amd64 cluster research">
    <meta name="author" content="Don Buddenbaum">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link rel="icon" href="../themes/daux/img/favicon-blue.png" type="image/x-icon">

    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- JS -->
    <script>
        window.base_url = "../";
        document.documentElement.classList.remove('no-js');
    </script>

    <!-- Font -->
    
    <!-- CSS -->
            <link href='../themes/daux/css/theme-blue.min.css' rel='stylesheet' type='text/css'>
            <link href='../daux_libraries/search.css' rel='stylesheet' type='text/css'>
    </head>
<body class="">
    <div class="Columns content">
    <aside class="Columns__left Collapsible">
        <button type="button" class="Button Collapsible__trigger" aria-controls="sidebar_content" aria-expanded="false" aria-label="Toggle navigation">
            <span class="Collapsible__trigger__bar"></span>
            <span class="Collapsible__trigger__bar"></span>
            <span class="Collapsible__trigger__bar"></span>
        </button>

        <a class="Brand" href="../index.html">Kalaxy2 Cluster</a>

    <form role='search' action="/" method="get" class="Search" id="search_form">
        <label for="search_input">
            <span class='u-visuallyHidden'>Search</span>
        </label>
        <input
            type="search"
            id="search_input"
            class="Search__field"
            placeholder="Search..."
            aria-label="Search..."
            autocomplete="on"
            results=25
            autosave=text_search
        >
        <label>
            <input type="submit" class='u-visuallyHidden' />
            <span class='u-visuallyHidden'>Search...</span>
            <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451">
                <path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/>
            </svg>
        </label>
    </form>

        <div class="Collapsible__content" id="sidebar_content">
            <!-- Navigation -->
            <ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>ai</a><ul class='Nav'>
<li class='Nav__item '><a href="../ai/convolutional_neural_network.html">convolutional neural network</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>ansible</a><ul class='Nav'>
<li class='Nav__item '><a href="../ansible/ansible_automation.html">ansible automation</a></li>
<li class='Nav__item '><a href="../ansible/microk8s_setup.html">microk8s setup</a></li>
<li class='Nav__item '><a href="../ansible/storage.html">storage</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>automation</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>github</a><ul class='Nav'>
<li class='Nav__item '><a href="../automation/github/actions.html">actions</a></li></ul></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>cicd</a><ul class='Nav'>
<li class='Nav__item '><a href="../cicd/jenkins_argocd.html">jenkins argocd</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>clickhouse</a><ul class='Nav'>
<li class='Nav__item '><a href="../clickhouse/docker.html">docker</a></li>
<li class='Nav__item '><a href="../clickhouse/documentation.html">documentation</a></li>
<li class='Nav__item '><a href="../clickhouse/kubernetes_operator.html">kubernetes operator</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>cloud</a><ul class='Nav'>
<li class='Nav__item '><a href="../cloud/next_cloud.html">next cloud</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>data engineering</a><ul class='Nav'>
<li class='Nav__item '><a href="../data_engineering/deltalake.html">deltalake</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>databases</a><ul class='Nav'>
<li class='Nav__item '><a href="../databases/cockroachDB.html">cockroachDB</a></li>
<li class='Nav__item '><a href="../databases/mongodb.html">mongodb</a></li>
<li class='Nav__item '><a href="../databases/mysql.html">mysql</a></li>
<li class='Nav__item '><a href="../databases/performant_datamodels.html">performant datamodels</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>documentation</a><ul class='Nav'>
<li class='Nav__item '><a href="../documentation/documentation.html">documentation</a></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>nodejs</a><ul class='Nav'>
<li class='Nav__item '><a href="../documentation/nodejs/face_recognition_attendance_system.html">face recognition attendance system</a></li>
<li class='Nav__item '><a href="../documentation/nodejs/node.html">node</a></li></ul></li>
<li class='Nav__item '><a href="../documentation/resume.html">resume</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>file system</a><ul class='Nav'>
<li class='Nav__item '><a href="../file_system/backup.html">backup</a></li>
<li class='Nav__item '><a href="../file_system/ceph.html">ceph</a></li>
<li class='Nav__item '><a href="../file_system/crd.html">crd</a></li>
<li class='Nav__item '><a href="../file_system/longhorn.html">longhorn</a></li>
<li class='Nav__item '><a href="../file_system/minio.html">minio</a></li>
<li class='Nav__item '><a href="../file_system/nfs.html">nfs</a></li>
<li class='Nav__item '><a href="../file_system/openebs.html">openebs</a></li>
<li class='Nav__item '><a href="../file_system/rook_ceph.html">rook ceph</a></li>
<li class='Nav__item '><a href="../file_system/samba.html">samba</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>hosting homelab on internet</a><ul class='Nav'>
<li class='Nav__item '><a href="../hosting_homelab_on_internet/cloudflare.html">cloudflare</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>iac</a><ul class='Nav'>
<li class='Nav__item '><a href="../iac/pulumi.html">pulumi</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>id auth</a><ul class='Nav'>
<li class='Nav__item '><a href="../id_auth/zitadel.html">zitadel</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>ideas</a><ul class='Nav'>
<li class='Nav__item '><a href="../ideas/AI_ideas.html">AI ideas</a></li>
<li class='Nav__item '><a href="../ideas/sources.html">sources</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>iris</a><ul class='Nav'>
<li class='Nav__item '><a href="../iris/restapi.html">restapi</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>java</a><ul class='Nav'>
<li class='Nav__item '><a href="../java/knotes.html">knotes</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>jupyter tensorflow</a><ul class='Nav'>
<li class='Nav__item '><a href="../jupyter_tensorflow/jupyter_tensorflow.html">jupyter tensorflow</a></li></ul></li>
<li class='Nav__item '><a href="../microk8s_add_ons.html">microk8s add ons</a></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>nfs</a><ul class='Nav'>
<li class='Nav__item '><a href="../nfs/nfs_csi.html">nfs-csi</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>nodejs</a><ul class='Nav'>
<li class='Nav__item '><a href="../nodejs/face_recognition.html">face recognition</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>object storage</a><ul class='Nav'>
<li class='Nav__item '><a href="../object_storage/minio.html">minio</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>project management</a><ul class='Nav'>
<li class='Nav__item '><a href="../project_management/open_project.html">open project</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>python</a><ul class='Nav'>
<li class='Nav__item '><a href="../python/django_cicd_ecom_k8s.html">django cicd ecom k8s</a></li>
<li class='Nav__item '><a href="../python/environment.html">environment</a></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>frameworks</a><ul class='Nav'>
<li class='Nav__item '><a href="../python/frameworks/click.html">click</a></li>
<li class='Nav__item '><a href="../python/frameworks/django.html">django</a></li></ul></li>
<li class='Nav__item '><a href="../python/nicegui.html">nicegui</a></li>
<li class='Nav__item '><a href="../python/pollapp.html">pollapp</a></li></ul></li>
<li class='Nav__item '><a href="../references/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>references</a><ul class='Nav'></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>remove</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>microk8s</a><ul class='Nav'>
<li class='Nav__item '><a href="../remove/microk8s/microk8s_node.html">microk8s node</a></li></ul></li></ul></li>
<li class='Nav__item Nav__item--open has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>setup</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>argocd</a><ul class='Nav'>
<li class='Nav__item '><a href="../setup/argocd/argocd.html">argocd</a></li></ul></li>
<li class='Nav__item '><a href="../setup/microk8s.html">microk8s</a></li>
<li class='Nav__item '><a href="../setup/minio.html">minio</a></li>
<li class='Nav__item Nav__item--active'><a href="../setup/notes.html">notes</a></li>
<li class='Nav__item '><a href="../setup/podnodeselector.html">podnodeselector</a></li>
<li class='Nav__item '><a href="../setup/README.html">README</a></li>
<li class='Nav__item '><a href="../setup/rpi_usb_ubuntu.html">rpi usb ubuntu</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>utilities</a><ul class='Nav'>
<li class='Nav__item '><a href="../utilities/k8s_cmd_ref.html">k8s cmd ref</a></li>
<li class='Nav__item '><a href="../utilities/k9s.html">k9s</a></li>
<li class='Nav__item '><a href="../utilities/kube_shark.html">kube shark</a></li>
<li class='Nav__item '><a href="../utilities/pvc_backup.html">pvc backup</a></li></ul></li></ul>
            <div class="Links">
                            </div>

                            <div class="CodeToggler">
                    <hr/>
                    <label class="Checkbox">Show Code Blocks                        <input type="checkbox" class="CodeToggler__button--main" checked="checked"/>
                        <div class="Checkbox__indicator"></div>
                    </label>
                </div>
            
            <div class="DarkModeToggler">
                <hr/>
                <label class="Checkbox">Dark Mode                    <input type="checkbox" class="ColorMode__button" />
                    <div class="Checkbox__indicator"></div>
                </label>
            </div>

                
                        </div>
    </aside>
    <div class="Columns__right">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1><a href="../setup/microk8s.html">setup</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../setup/notes.html">notes</a></h1>
                    </div>

    <div class="s-content">
        <div class="TableOfContentsContainer">
    <h4 class="TableOfContentsContainer__title">Table of Contents</h4>
    <div class="TableOfContentsContainer__content">
        <ul class="TableOfContents">
<li>
<a href="#installation-notes">Installation Notes</a>
<ul>
<li>
<a href="#raspberry-pi-monitoring">Raspberry Pi Monitoring</a>
</li>
<li>
<a href="#make-up">make up</a>
</li>
<li>
<a href="#flash">Flash</a>
</li>
<li>
<a href="#amd64">AMD64</a>
<ul>
<li>
<a href="#static-ip">static ip</a>
</li>
<li>
<a href="#ssh">ssh</a>
</li>
<li>
<a href="#swapfile">swapfile</a>
</li>
<li>
<a href="#update-upgrade">update/upgrade</a>
</li>
<li>
<a href="#add-user">Add User</a>
</li>
<li>
<a href="#change-password">Change password</a>
</li>
<li>
<a href="#sudo">SUDO</a>
</li>
</ul>
</li>
<li>
<a href="#copy-id">Copy Id</a>
<ul>
<li>
<a href="#getting-events-from-kubernetes">getting events from kubernetes</a>
</li>
<li>
<a href="#persistent-volume">Persistent Volume</a>
</li>
<li>
<a href="#update-secutiry-fixes">update secutiry fixes</a>
</li>
</ul>
</li>
<li>
<a href="#temperature-probe-amd64">temperature probe amd64</a>
</li>
<li>
<a href="#updating-linux">Updating Linux</a>
</li>
</ul>
</li>
</ul>    </div>
</div>
<h1><a id="installation-notes" href="#installation-notes" class="Permalink" aria-hidden="true" title="Permalink">#</a>Installation Notes</h1>
<ul>
<li>
<p><a href="https://github.com/Trackhe/Raspberry64bitKubernetesServerDualstack" class="Link--external" rel="noopener noreferrer">Build Bare Metal Kubernetes Dualstack Calico Metallb RaspberryPI 4 Ubuntu Server 64bit. (64bit required!!!)</a></p>
</li>
<li>
<p><a href="https://blog.valouille.fr/post/2019-08-23-force-pods-in-a-specific-namespace-to-schedule-on-defined-nodes-with-kubernetes/" class="Link--external" rel="noopener noreferrer">Force all pods in a specific namespace to schedule on defined hosts with Kubernetes</a></p>
</li>
<li>
<p><a href="https://vocon-it.com/2019/09/08/cka-12-kubernetes-labels-and-node-selectors/" class="Link--external" rel="noopener noreferrer">Control Pod Placement to Projects</a></p>
</li>
<li>
<p><a href="https://www.mgasch.com/post/podnodesel/" class="Link--external" rel="noopener noreferrer">Understanding and using the Kubernetes PodNodeSelector Admission Controller</a></p>
</li>
<li>
<p><a href="https://itnext.io/automated-ha-kubernetes-deployment-on-raspberry-pis-408f38cd836c" class="Link--external" rel="noopener noreferrer">k8s HA cluster installation</a></p>
</li>
<li>
<p><a href="https://fabianlee.org/" class="Link--external" rel="noopener noreferrer">Fabian Lee : Software Engineer</a></p>
</li>
<li>
<p><a href="https://linuxhint.com/install-ubuntu-desktop-20-04-lts-on-raspberry-pi-4/" class="Link--external" rel="noopener noreferrer">Install Ubuntu Desktop 20.04 LTS on Raspberry Pi 4</a></p>
</li>
<li>
<p><a href="https://blog.palark.com/installing-fully-fledged-vanilla-kubernetes-on-raspberry-pi/" class="Link--external" rel="noopener noreferrer">Installing fully-fledged vanilla Kubernetes on Raspberry Pi</a></p>
</li>
</ul>
<h2><a id="raspberry-pi-monitoring" href="#raspberry-pi-monitoring" class="Permalink" aria-hidden="true" title="Permalink">#</a>Raspberry Pi Monitoring</h2>
<pre><code>sudo apt-get update &amp;&amp; sudo apt-get install htop -y
</code></pre>
<h2><a id="make-up" href="#make-up" class="Permalink" aria-hidden="true" title="Permalink">#</a>make up</h2>
<pre><code>xcode-select --install
</code></pre>
<p><img src="../images/cluster_initial_up.png" alt="clusterUp" /></p>
<h2><a id="flash" href="#flash" class="Permalink" aria-hidden="true" title="Permalink">#</a>Flash</h2>
<pre><code class="hljs bash">flash --userdata setup/cloud-config.yml ~/Downloads/ubuntu-20.04-preinstalled-server-arm64+raspi.img
    
</code></pre>
<h2><a id="amd64" href="#amd64" class="Permalink" aria-hidden="true" title="Permalink">#</a>AMD64</h2>
<h3><a id="static-ip" href="#static-ip" class="Permalink" aria-hidden="true" title="Permalink">#</a>static ip</h3>
<ul>
<li>(AMD) sudo vim /etc/netplan/01-netcfg.yaml</li>
<li>(ARM) /etc/netplan/50-cloud-init.yaml</li>
</ul>
<pre><code>
      network:
        version: 2
        ethernets:
          eth0:
            dhcp4: false
            addresses: [192.168.2.5?/16]
            gateway4: 192.168.2.253
            nameservers:
              addresses: [192.168.2.253, 8.8.8.8, 8.8.4.4]

</code></pre>
<ul>
<li>sudo netplan apply</li>
<li>ip address</li>
</ul>
<h3><a id="ssh" href="#ssh" class="Permalink" aria-hidden="true" title="Permalink">#</a>ssh</h3>
<ul>
<li>sudo apt install ssh</li>
<li>sudo systemctl enable –now ssh</li>
<li>sudo systemctl status ssh</li>
</ul>
<h3><a id="swapfile" href="#swapfile" class="Permalink" aria-hidden="true" title="Permalink">#</a>swapfile</h3>
<ul>
<li>sudo vim /etc/fstab</li>
</ul>
<pre><code>#/swapfile

</code></pre>
<ul>
<li>sudo reboot</li>
</ul>
<p>or</p>
<ul>
<li>sudo poweroff</li>
</ul>
<h3><a id="update-upgrade" href="#update-upgrade" class="Permalink" aria-hidden="true" title="Permalink">#</a>update/upgrade</h3>
<p>su</p>
<h3><a id="add-user" href="#add-user" class="Permalink" aria-hidden="true" title="Permalink">#</a>Add User</h3>
<ul>
<li>
<a href="https://www.unixtutorial.org/how-to-use-visudo/" class="Link--external" rel="noopener noreferrer">How To Use visudo</a>
</li>
<li>
<a href="https://www.linuxfordevices.com/tutorials/linux/sudo-nopasswd" class="Link--external" rel="noopener noreferrer">Sudo nopasswd: How to run commands as root without a password?</a>
</li>
</ul>
<pre><code>sudo adduser -u 1200 &lt;username&gt;

</code></pre>
<h3><a id="change-password" href="#change-password" class="Permalink" aria-hidden="true" title="Permalink">#</a>Change password</h3>
<p><strong>pi@arm64-05:~$</strong> sudo passwd dbuddenbaum</p>
<pre><code>New password:
Retype new password:
passwd: password updated successfully
</code></pre>
<h3><a id="sudo" href="#sudo" class="Permalink" aria-hidden="true" title="Permalink">#</a>SUDO</h3>
<p>sudo visudo</p>
<pre><code>
dbuddenbaum     ALL=(ALL) NOPASSWD:ALL

</code></pre>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<h2><a id="copy-id" href="#copy-id" class="Permalink" aria-hidden="true" title="Permalink">#</a>Copy Id</h2>
<p>ssh-copy-id pi@$ip_address</p>
<p>=======
ssh-copy-id <a href="mailto:dbuddenbaum@192.168.2.58" class="Link--external" rel="noopener noreferrer">dbuddenbaum@192.168.2.58</a></p>
<pre><code>/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/Users/donbuddenbaum/.ssh/id_rsa.pub&quot;
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
dbuddenbaum@192.168.2.58's password:

Number of key(s) added:        1

Now try logging into the machine, with:   &quot;ssh 'dbuddenbaum@192.168.2.58'&quot;
and check to make sure that only the key(s) you wanted were added.
</code></pre>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>38d6a03510f3dafb5c27383383689baf396cd5ce
<strong>dbuddenbaum@amd64-worker-03:~$</strong> sudo vim /etc/sysctl.d/99-kubernetes-cri.conf</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<pre><code>net.bridge.bridge-nf-call-iptables=1
/usr/sbin/sysctl net.bridge.bridge-nf-call-iptables=1
/usr/sbin/sysctl/net.bridge.bridge-nf-call-iptables=1
net.bridge.bridge-nf-call-ip6tables=1
net.bridge.bridge-nf-call-arptables=1
sudo modprobe br_netfilter
</code></pre>
<p><a href="https://blog.thoughtsandbeers.com/2018/02/27/Install-Ceph-on-ARM64-SBCs-using-Rook/" class="Link--external" rel="noopener noreferrer">install Ceph on ARM64 SBCs using Rook - kubernetes-xenial main v1.9.3</a></p>
<p><strong>dbuddenbaum@amd64-worker-03:~$</strong> echo “deb <a href="http://packages.azlux.fr/debian/" class="Link--external" rel="noopener noreferrer">http://packages.azlux.fr/debian/</a> buster main” | sudo tee /etc/apt/sources.list.d/azlux.list</p>
<pre><code>deb http://packages.azlux.fr/debian/ buster main

</code></pre>
<p><strong>dbuddenbaum@amd64-worker-03:~$</strong> wget -qO  - <a href="https://azlux.fr/repo.gpg.key" class="Link--external" rel="noopener noreferrer">https://azlux.fr/repo.gpg.key</a> | sudo apt-key add -</p>
<pre><code>OK
</code></pre>
<p><strong>dbuddenbaum@amd64-worker-03:~$</strong> sudo apt update</p>
<pre><code>Hit:1 http://us.archive.ubuntu.com/ubuntu focal InRelease
Building dependency tree
Reading state information... Done
All packages are up to date.
N: Skipping acquire of configured file 'stable/binary-i386/Packages' as repository 'https://download.docker.com/linux/ubuntu focal InRelease' doesn't support architecture 'i386'
</code></pre>
<p><strong>dbuddenbaum@amd64-worker-03:~$</strong> sudo apt install log2ram</p>
<pre><code>Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages were automatically installed and are no longer required:
  conntrack cri-tools ebtables socat
Use 'sudo apt autoremove' to remove them.
The following NEW packages will be installed:
  log2ram
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 4288 B of archives.
After this operation, 0 B of additional disk space will be used.
Get:1 http://packages.azlux.fr/debian buster/main amd64 log2ram all 1.6.0 [4288 B]
Fetched 4288 B in 1s (7037 B/s)
Selecting previously unselected package log2ram.
(Reading database ... 107469 files and directories currently installed.)
Preparing to unpack .../archives/log2ram_1.6.0_all.deb ...
Unpacking log2ram (1.6.0) ...
Setting up log2ram (1.6.0) ...
Created symlink /etc/systemd/system/sysinit.target.wants/log2ram.service → /etc/systemd/system/log2ram.service.
Created symlink /etc/systemd/system/timers.target.wants/log2ram-daily.timer → /etc/systemd/system/log2ram-daily.timer.
#####         Reboot to activate log2ram         #####
##### edit /etc/log2ram.conf to configure options ####
</code></pre>
<p>make OPTS=–limit=amd64-worker-xx up</p>
<p><a href="https://blog.scottlowe.org/2019/08/15/reconstructing-the-join-command-for-kubeadm/#:~:text=Be%20aware%20that%20tokens%20have,%2C%20though%2C%20generate%20another%20value." class="Link--external" rel="noopener noreferrer">fix token</a></p>
<p>kubeadm token create -&gt; build/k8s-token</p>
<p><strong>dbuddenbaum@arm64-master-01:~$</strong> sudo kubeadm token create –print-join-command</p>
<pre><code>W1017 21:24:48.048542 1003621 validation.go:28] Cannot validate kube-proxy config - no validator is available
W1017 21:24:48.048690 1003621 validation.go:28] Cannot validate kubelet config - no validator is available
kubeadm join 192.168.2.50:6443 --token 1lzi9g.q1e5iabf9ct3khwe     --discovery-token-ca-cert-hash sha256:758ae780462b33c21506c4052e4e1de8ddec35ffc167a931fa1cd6f85ff9ede3
</code></pre>
<p><strong>dbuddenbaum@amd64-worker-02:~$</strong> sudo kubeadm join 192.168.2.50:6443 –token 1lzi9g.q1e5iabf9ct3khwe     –discovery-token-ca-cert-hash sha256:758ae780462b33c21506c4052e4e1de8ddec35ffc167a931fa1cd6f85ff9ede3</p>
<pre><code>W1018 01:26:30.473800    6631 join.go:346] [preflight] WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.
[preflight] Running pre-flight checks
	[WARNING IsDockerSystemdCheck]: detected &quot;cgroupfs&quot; as the Docker cgroup driver. The recommended driver is &quot;systemd&quot;. Please follow the guide at https://kubernetes.io/docs/setup/cri/
[preflight] Reading configuration from the cluster...
[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[kubelet-start] Downloading configuration for the kubelet from the &quot;kubelet-config-1.17&quot; ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Starting the kubelet
[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...

This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run 'kubectl get nodes' on the control-plane to see this node join the cluster.
</code></pre>
<h3><a id="getting-events-from-kubernetes" href="#getting-events-from-kubernetes" class="Permalink" aria-hidden="true" title="Permalink">#</a>getting events from kubernetes</h3>
<p>kubectl get events –all-namespaces  –sort-by=’.metadata.creationTimestamp’</p>
<h3><a id="persistent-volume" href="#persistent-volume" class="Permalink" aria-hidden="true" title="Permalink">#</a>Persistent Volume</h3>
<h3><a id="update-secutiry-fixes" href="#update-secutiry-fixes" class="Permalink" aria-hidden="true" title="Permalink">#</a>update secutiry fixes</h3>
<p>apt-get update
sudo apt-get install -y –only-upgrade $( apt-get –just-print upgrade | awk ‘tolower($4) ~ /.<em>security.</em>/ || tolower($5) ~ /.<em>security.</em>/ {print $2}’ | sort | uniq )</p>
<p>###cgroups for intel</p>
<p>One aspect I want to point out is setting the cgroup for use by kubeadm. If you choose to use Docker as your container runtime, you should set it to use the cgroup systemd rather than cgroupfs as explained <a href="https://www.linkedin.com/pulse/set-up-kubernetes-your-home-lab-gregory-grubbs" class="Link--external" rel="noopener noreferrer">here</a>.</p>
<p>In /etc/docker/daemon.conf</p>
<pre><code>  {
    &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],
    &quot;log-driver&quot;: &quot;json-file&quot;,
    &quot;log-opts&quot;: {
      &quot;max-size&quot;: &quot;100m&quot;
    },
    &quot;storage-driver&quot;: &quot;overlay2&quot;
  }
</code></pre>
<p>Then reload</p>
<pre><code>  sudo systemctl daemon-reload
  sudo systemctl restart docker
</code></pre>
<h2><a id="temperature-probe-amd64" href="#temperature-probe-amd64" class="Permalink" aria-hidden="true" title="Permalink">#</a>temperature probe amd64</h2>
<p>sudo apt-get install lm-sensors</p>
<p>sudo service kmod start</p>
<p><strong>dbuddenbaum@amd64-05:~$</strong> sensors</p>
<pre><code>coretemp-isa-0000
Adapter: ISA adapter
Core 0:       +70.0°C  (high = +74.0°C, crit = +100.0°C)
Core 1:       +63.0°C  (high = +74.0°C, crit = +100.0°C)
Core 2:       +65.0°C  (high = +74.0°C, crit = +100.0°C)
Core 3:       +64.0°C  (high = +74.0°C, crit = +100.0°C)
</code></pre>
<p>sudo sensors-detect</p>
<h2><a id="updating-linux" href="#updating-linux" class="Permalink" aria-hidden="true" title="Permalink">#</a>Updating Linux</h2>
<p>sudo apt-get update</p>
<p>sudo apt-get upgrade</p>
<p>sudo reboot</p>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../setup/minio.html">Previous</a></li>            <li class=Pager--next><a href="../setup/podnodeselector.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- JS -->
            <script src="../themes/daux/js/main.mjs"></script>
    
        <script>
        
        window.searchLanguage = "";
        window.searchTranslation = {"Search_one_result":"1 result","Search_results":"!count results","Search_no_results":"Nothing found","Search_common_words_ignored":"Common words are largely ignored","Search_too_short":"Search too short","Search_one_character_or_more":"Should be one character or more","Search_should_be_x_or_more":"Should be !min characters or more","Link_previous":"Previous","Link_next":"Next"};
    </script>

    <!-- Search -->
    <script type="text/javascript" src="../daux_libraries/search.min.js"></script>

    <script>
        window.search({'base_url': '../'})
    </script>
</body>
</html>

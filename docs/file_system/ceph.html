<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <title>ceph - Kalaxy2 MicroK8s Cluster</title>
    <meta name="description" content="Arm64/Amd64 cluster research">
    <meta name="author" content="Don Buddenbaum">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link rel="icon" href="../themes/daux/img/favicon-blue.png" type="image/x-icon">

    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- JS -->
    <script>
        window.base_url = "../";
        document.documentElement.classList.remove('no-js');
    </script>

    <!-- Font -->
    
    <!-- CSS -->
            <link href='../themes/daux/css/theme-blue.min.css' rel='stylesheet' type='text/css'>
            <link href='../daux_libraries/search.css' rel='stylesheet' type='text/css'>
    </head>
<body class="">
    <div class="Columns content">
    <aside class="Columns__left Collapsible">
        <button type="button" class="Button Collapsible__trigger" aria-controls="sidebar_content" aria-expanded="false" aria-label="Toggle navigation">
            <span class="Collapsible__trigger__bar"></span>
            <span class="Collapsible__trigger__bar"></span>
            <span class="Collapsible__trigger__bar"></span>
        </button>

        <a class="Brand" href="../index.html">Kalaxy2 MicroK8s Cluster</a>

    <form role='search' action="/" method="get" class="Search" id="search_form">
        <label for="search_input">
            <span class='u-visuallyHidden'>Search</span>
        </label>
        <input
            type="search"
            id="search_input"
            class="Search__field"
            placeholder="Search..."
            aria-label="Search..."
            autocomplete="on"
            results=25
            autosave=text_search
        >
        <label>
            <input type="submit" class='u-visuallyHidden' />
            <span class='u-visuallyHidden'>Search...</span>
            <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451">
                <path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/>
            </svg>
        </label>
    </form>

        <div class="Collapsible__content" id="sidebar_content">
            <!-- Navigation -->
            <ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>ai</a><ul class='Nav'>
<li class='Nav__item '><a href="../ai/convolutional_neural_network.html">convolutional neural network</a></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>jupyter tensorflow</a><ul class='Nav'>
<li class='Nav__item '><a href="../ai/jupyter_tensorflow/jupyter_tensorflow.html">jupyter tensorflow</a></li></ul></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>ansible</a><ul class='Nav'>
<li class='Nav__item '><a href="../ansible/ansible_automation.html">ansible automation</a></li>
<li class='Nav__item '><a href="../ansible/microk8s_setup.html">microk8s setup</a></li>
<li class='Nav__item '><a href="../ansible/storage.html">storage</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>apis</a><ul class='Nav'>
<li class='Nav__item '><a href="../apis/apidog.html">apidog</a></li>
<li class='Nav__item '><a href="../apis/design_patterns.html">design patterns</a></li>
<li class='Nav__item '><a href="../apis/management.html">management</a></li>
<li class='Nav__item '><a href="../apis/microks.html">microks</a></li>
<li class='Nav__item '><a href="../apis/postman.html">postman</a></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>web services</a><ul class='Nav'>
<li class='Nav__item '><a href="../apis/web_services/soap.html">soap</a></li>
<li class='Nav__item '><a href="../apis/web_services/webservices.html">webservices</a></li>
<li class='Nav__item '><a href="../apis/web_services/wsdl.html">wsdl</a></li></ul></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>automation</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>argocd</a><ul class='Nav'>
<li class='Nav__item '><a href="../automation/argocd/argocd.html">argocd</a></li>
<li class='Nav__item '><a href="../automation/argocd/argocd_image_updater.html">argocd image updater</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>bpms</a><ul class='Nav'>
<li class='Nav__item '><a href="../automation/bpms/activiti.html">activiti</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>github</a><ul class='Nav'>
<li class='Nav__item '><a href="../automation/github/actions.html">actions</a></li>
<li class='Nav__item '><a href="../automation/github/settings.html">settings</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>helm</a><ul class='Nav'>
<li class='Nav__item '><a href="../automation/helm/helm.html">helm</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>microk8s</a><ul class='Nav'>
<li class='Nav__item '><a href="../automation/microk8s/microk8s_add_ons.html">microk8s add ons</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>slack</a><ul class='Nav'>
<li class='Nav__item '><a href="../automation/slack/slack.html">slack</a></li></ul></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>cicd</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>argo gitsctions crossplane</a><ul class='Nav'>
<li class='Nav__item '><a href="../cicd/argo_gitsctions_crossplane/implementation.html">implementation</a></li></ul></li>
<li class='Nav__item '><a href="../cicd/argocd.html">argocd</a></li>
<li class='Nav__item '><a href="../cicd/automation.html">automation</a></li>
<li class='Nav__item '><a href="../cicd/jenkins_argocd.html">jenkins argocd</a></li>
<li class='Nav__item '><a href="../cicd/maven.html">maven</a></li>
<li class='Nav__item '><a href="../cicd/testing.html">testing</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>cloud</a><ul class='Nav'>
<li class='Nav__item '><a href="../cloud/next_cloud.html">next cloud</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>data engineering</a><ul class='Nav'>
<li class='Nav__item '><a href="../data_engineering/deltalake.html">deltalake</a></li>
<li class='Nav__item '><a href="../data_engineering/mageAI.html">mageAI</a></li>
<li class='Nav__item '><a href="../data_engineering/pipelines.html">pipelines</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>databases</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>clickhouse</a><ul class='Nav'>
<li class='Nav__item '><a href="../databases/clickhouse/docker.html">docker</a></li>
<li class='Nav__item '><a href="../databases/clickhouse/documentation.html">documentation</a></li>
<li class='Nav__item '><a href="../databases/clickhouse/kubernetes_operator.html">kubernetes operator</a></li></ul></li>
<li class='Nav__item '><a href="../databases/cockroachDB.html">cockroachDB</a></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>iris</a><ul class='Nav'>
<li class='Nav__item '><a href="../databases/iris/restapi.html">restapi</a></li></ul></li>
<li class='Nav__item '><a href="../databases/mongodb.html">mongodb</a></li>
<li class='Nav__item '><a href="../databases/mysql.html">mysql</a></li>
<li class='Nav__item '><a href="../databases/options.html">options</a></li>
<li class='Nav__item '><a href="../databases/performant_datamodels.html">performant datamodels</a></li>
<li class='Nav__item '><a href="../databases/starrocks.html">starrocks</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>etl</a><ul class='Nav'>
<li class='Nav__item '><a href="../etl/mage_etl.html">mage etl</a></li></ul></li>
<li class='Nav__item Nav__item--open has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>file system</a><ul class='Nav'>
<li class='Nav__item '><a href="../file_system/backup.html">backup</a></li>
<li class='Nav__item Nav__item--active'><a href="../file_system/ceph.html">ceph</a></li>
<li class='Nav__item '><a href="../file_system/crd.html">crd</a></li>
<li class='Nav__item '><a href="../file_system/deltalake_vs_parquet.html">deltalake vs parquet</a></li>
<li class='Nav__item '><a href="../file_system/longhorn.html">longhorn</a></li>
<li class='Nav__item '><a href="../file_system/minio.html">minio</a></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>nfs</a><ul class='Nav'>
<li class='Nav__item '><a href="../file_system/nfs/nfs.html">nfs</a></li>
<li class='Nav__item '><a href="../file_system/nfs/nfs_csi.html">nfs-csi</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>object storage</a><ul class='Nav'>
<li class='Nav__item '><a href="../file_system/object_storage/minio.html">minio</a></li></ul></li>
<li class='Nav__item '><a href="../file_system/openebs.html">openebs</a></li>
<li class='Nav__item '><a href="../file_system/rook_ceph.html">rook ceph</a></li>
<li class='Nav__item '><a href="../file_system/samba.html">samba</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>generativeAI</a><ul class='Nav'>
<li class='Nav__item '><a href="../generativeAI/chatGPT.html">chatGPT</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>homelab</a><ul class='Nav'>
<li class='Nav__item '><a href="../homelab/cloudflare.html">cloudflare</a></li>
<li class='Nav__item '><a href="../homelab/no_ip.html">no-ip</a></li>
<li class='Nav__item '><a href="../homelab/squarespace.html">squarespace</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>iac</a><ul class='Nav'>
<li class='Nav__item '><a href="../iac/pulumi.html">pulumi</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>id auth</a><ul class='Nav'>
<li class='Nav__item '><a href="../id_auth/zitadel.html">zitadel</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>ideas</a><ul class='Nav'>
<li class='Nav__item '><a href="../ideas/AI_ideas.html">AI ideas</a></li>
<li class='Nav__item '><a href="../ideas/sources.html">sources</a></li></ul></li>
<li class='Nav__item '><a href="../microk8s.html">microk8s</a></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>observability</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>grafana</a><ul class='Nav'>
<li class='Nav__item '><a href="../observability/grafana/grafana.html">grafana</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>prometheus</a><ul class='Nav'>
<li class='Nav__item '><a href="../observability/prometheus/prometheus.html">prometheus</a></li></ul></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>operations</a><ul class='Nav'>
<li class='Nav__item '><a href="../operations/crossplane.html">crossplane</a></li>
<li class='Nav__item '><a href="../operations/operators.html">operators</a></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>registries</a><ul class='Nav'>
<li class='Nav__item '><a href="../operations/registries/ghcrIO.html">ghcrIO</a></li></ul></li>
<li class='Nav__item '><a href="../operations/shell_operator_demo.html">shell-operator-demo</a></li>
<li class='Nav__item '><a href="../operations/shell_operator.html">shell operator</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>programming</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>java</a><ul class='Nav'>
<li class='Nav__item '><a href="../programming/java/java.html">java</a></li>
<li class='Nav__item '><a href="../programming/java/knotes.html">knotes</a></li>
<li class='Nav__item '><a href="../programming/java/spring.html">spring</a></li>
<li class='Nav__item '><a href="../programming/java/springcloud.html">springcloud</a></li>
<li class='Nav__item '><a href="../programming/java/swagger.html">swagger</a></li>
<li class='Nav__item '><a href="../programming/java/webservices.html">webservices</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>nodejs</a><ul class='Nav'>
<li class='Nav__item '><a href="../programming/nodejs/face_recognition.html">face recognition</a></li>
<li class='Nav__item '><a href="../programming/nodejs/frameworks.html">frameworks</a></li>
<li class='Nav__item '><a href="../programming/nodejs/node.html">node</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>playgrounds</a><ul class='Nav'>
<li class='Nav__item '><a href="../programming/playgrounds/kllrcoda.html">kllrcoda</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>python</a><ul class='Nav'>
<li class='Nav__item '><a href="../programming/python/django_cicd_ecom_k8s.html">django cicd ecom k8s</a></li>
<li class='Nav__item '><a href="../programming/python/environment.html">environment</a></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>frameworks</a><ul class='Nav'>
<li class='Nav__item '><a href="../programming/python/frameworks/click.html">click</a></li>
<li class='Nav__item '><a href="../programming/python/frameworks/django.html">django</a></li></ul></li>
<li class='Nav__item '><a href="../programming/python/nicegui.html">nicegui</a></li>
<li class='Nav__item '><a href="../programming/python/pollapp.html">pollapp</a></li></ul></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>project management</a><ul class='Nav'>
<li class='Nav__item '><a href="../project_management/open_project.html">open project</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>references</a><ul class='Nav'>
<li class='Nav__item '><a href="../references/glossary.html">glossary</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>remove</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>microk8s</a><ul class='Nav'>
<li class='Nav__item '><a href="../remove/microk8s/microk8s_node.html">microk8s node</a></li></ul></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>setup</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>argocd</a><ul class='Nav'>
<li class='Nav__item '><a href="../setup/argocd/argocd.html">argocd</a></li></ul></li>
<li class='Nav__item '><a href="../setup/microk8s.html">microk8s</a></li>
<li class='Nav__item '><a href="../setup/minio.html">minio</a></li>
<li class='Nav__item '><a href="../setup/notes.html">notes</a></li>
<li class='Nav__item '><a href="../setup/podnodeselector.html">podnodeselector</a></li>
<li class='Nav__item '><a href="../setup/README.html">README</a></li>
<li class='Nav__item '><a href="../setup/rpi_usb_ubuntu.html">rpi usb ubuntu</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>standards</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>apis</a><ul class='Nav'>
<li class='Nav__item '><a href="../standards/apis/rest_standards.html">rest standards</a></li></ul></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>usecases</a><ul class='Nav'>
<li class='Nav__item '><a href="../usecases/nutrition_image_recognition.html">nutrition image recognition</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>utilities</a><ul class='Nav'>
<li class='Nav__item '><a href="../utilities/justfile.html">justfile</a></li>
<li class='Nav__item '><a href="../utilities/k8s_cmd_ref.html">k8s cmd ref</a></li>
<li class='Nav__item '><a href="../utilities/k8s_troubleshooting.html">k8s troubleshooting</a></li>
<li class='Nav__item '><a href="../utilities/k9s.html">k9s</a></li>
<li class='Nav__item '><a href="../utilities/kube_shark.html">kube shark</a></li>
<li class='Nav__item '><a href="../utilities/pvc_backup.html">pvc backup</a></li>
<li class='Nav__item '><a href="../utilities/taskfile.html">taskfile</a></li>
<li class='Nav__item '><a href="../utilities/utilities.html">utilities</a></li></ul></li>
<li class='Nav__item  has-children'><a href="#" class="Nav__item__link Nav__item__link--nopage"><i class="Nav__arrow">&nbsp;</i>websites generation</a><ul class='Nav'>
<li class='Nav__item '><a href="../websites_generation/dauxio_kalaxy2.html">dauxio kalaxy2</a></li>
<li class='Nav__item '><a href="../websites_generation/resume.html">resume</a></li></ul></li></ul>
            <div class="Links">
                            </div>

                            <div class="CodeToggler">
                    <hr/>
                    <label class="Checkbox">Show Code Blocks                        <input type="checkbox" class="CodeToggler__button--main" checked="checked"/>
                        <div class="Checkbox__indicator"></div>
                    </label>
                </div>
            
            <div class="DarkModeToggler">
                <hr/>
                <label class="Checkbox">Dark Mode                    <input type="checkbox" class="ColorMode__button" />
                    <div class="Checkbox__indicator"></div>
                </label>
            </div>

                
                        </div>
    </aside>
    <div class="Columns__right">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1><a href="../file_system/backup.html">file system</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../file_system/ceph.html">ceph</a></h1>
                <span class="ModifiedDate">
            August 2, 2024 at 7:58 PM        </span>
                    </div>

    <div class="s-content">
        <div class="TableOfContentsContainer">
    <h4 class="TableOfContentsContainer__title">Table of Contents</h4>
    <div class="TableOfContentsContainer__content">
        <ul class="TableOfContents">
<li>
<a href="#ceph">CEPH</a>
<ul>
<li>
<a href="#setup-storage-devices-new">Setup storage devices  - New</a>
<ul>
<li>
<a href="#dbuddenbaum-arm64-worker-04">dbuddenbaum@arm64-worker-04:~$**</a>
</li>
<li>
<a href="#dbuddenbaum-arm64-worker-04-1">dbuddenbaum@arm64-worker-04:~$</a>
</li>
</ul>
</li>
<li>
<a href="#setup-for-rpi4">Setup for rPi4</a>
</li>
<li>
<a href="#old">Old</a>
</li>
<li>
<a href="#if-the-fstype-field-is-not-empty-there-is-a-filesystem-on-top-of-the-corresponding-device-in-this-case-you-can-use-sda-for-ceph-partitions">If the FSTYPE field is not empty, there is a filesystem on top of the corresponding device. In this case, you can use sda for Ceph partitions.</a>
<ul>
<li>
<a href="#dbuddenbaum-amd64-06-sudo-vi-etc-fstab">dbuddenbaum@amd64-06:~$** sudo vi /etc/fstab</a>
</li>
</ul>
</li>
<li>
<a href="#disk-clean-up">disk clean up</a>
</li>
<li>
<a href="#rook-ceph">Rook/Ceph</a>
</li>
<li>
<a href="#rook-tools">Rook Tools</a>
</li>
<li>
<a href="#crd-deletion-gets-stuck">CRD Deletion gets stuck</a>
</li>
<li>
<a href="#remove-storage-host-based-cluster">Remove storage Host-based cluster</a>
<ul>
<li>
<a href="#to-stop-the-rook-operator-run">To stop the Rook Operator, run</a>
</li>
<li>
<a href="#start-the-rook-operator-run">Start the Rook operator run:</a>
</li>
<li>
<a href="#purge-the-osd-from-the-ceph-cluster">Purge the OSD from the Ceph cluster</a>
</li>
<li>
<a href="#remove-the-osd">Remove the OSD</a>
</li>
<li>
<a href="#replace-an-osd">Replace an OSD</a>
</li>
</ul>
</li>
<li>
<a href="#block-storage">Block Storage</a>
</li>
<li>
<a href="#deploy-mongodb-community-edition-on-ceph-block-storage">Deploy MongoDB Community Edition on CEPH block storage</a>
</li>
</ul>
</li>
</ul>    </div>
</div>
<h1><a id="ceph" href="#ceph" class="Permalink" aria-hidden="true" title="Permalink">#</a>CEPH</h1>
<h2><a id="setup-storage-devices-new" href="#setup-storage-devices-new" class="Permalink" aria-hidden="true" title="Permalink">#</a>Setup storage devices  - New</h2>
<h3><a id="dbuddenbaum-arm64-worker-04" href="#dbuddenbaum-arm64-worker-04" class="Permalink" aria-hidden="true" title="Permalink">#</a>dbuddenbaum@arm64-worker-04:~$**</h3>
<p>sudo fdisk /dev/sda</p>
<pre><code>Welcome to fdisk (util-linux 2.34).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Command (m for help): p
Disk /dev/sda: 931.53 GiB, 1000204886016 bytes, 1953525168 sectors
Disk model: 002-1SD102
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disklabel type: gpt
Disk identifier: 4565B06D-9C14-48AC-ADCF-EDF03DD62518

Command (m for help): n
Partition number (1-128, default 1):
First sector (34-1953525134, default 2048):
Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-1953525134, default 1953525134): +32G

Created a new partition 1 of type 'Linux filesystem' and of size 32 GiB.
Partition #1 contains a signature.

Do you want to remove the signature? [Y]es/[N]o: y

The signature will be removed by a write command.

Command (m for help): n
Partition number (2-128, default 2):
First sector (67110912-1953525134, default 67110912):
Last sector, +/-sectors or +/-size{K,M,G,T,P} (67110912-1953525134, default 1953525134): +68G

Created a new partition 2 of type 'Linux filesystem' and of size 68 GiB.

Command (m for help): n
Partition number (3-128, default 3):
First sector (209717248-1953525134, default 209717248):
Last sector, +/-sectors or +/-size{K,M,G,T,P} (209717248-1953525134, default 1953525134):

Created a new partition 3 of type 'Linux filesystem' and of size 831.5 GiB.

Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.
</code></pre>
<h3><a id="dbuddenbaum-arm64-worker-04-1" href="#dbuddenbaum-arm64-worker-04-1" class="Permalink" aria-hidden="true" title="Permalink">#</a>dbuddenbaum@arm64-worker-04:~$</h3>
<p>lsblk -f</p>
<pre><code>NAME        FSTYPE   LABEL       UUID                                 FSAVAIL FSUSE% MOUNTPOINT
loop0       squashfs                                                        0   100% /snap/core18/1990
loop1       squashfs                                                        0   100% /snap/core18/2002
loop2       squashfs                                                        0   100% /snap/snapd/11408
loop3       squashfs                                                        0   100% /snap/snapd/11584
loop5       squashfs                                                        0   100% /snap/lxd/19648
loop6       squashfs                                                        0   100% /snap/lxd/20330
sda
├─sda1
├─sda2
└─sda3
mmcblk0
├─mmcblk0p1 vfat     system-boot B726-57E2                             132.8M    47% /boot/firmware
└─mmcblk0p2 ext4     writable    483efb12-d682-4daf-9b34-6e2f774b56f7    6.1G    75% /
</code></pre>
<h2><a id="setup-for-rpi4" href="#setup-for-rpi4" class="Permalink" aria-hidden="true" title="Permalink">#</a>Setup for rPi4</h2>
<p>###dbuddenbaum@arm64-worker-04:~$</p>
<p>sudo mkfs.xfs /dev/sda1 -f</p>
<pre><code>meta-data=/dev/sda1              isize=512    agcount=4, agsize=2097152 blks
         =                       sectsz=4096  attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1
data     =                       bsize=4096   blocks=8388608, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=4096, version=2
         =                       sectsz=4096  sunit=1 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
</code></pre>
<p>###dbuddenbaum@arm64-worker-04:~$</p>
<p>sudo mkfs.ext4 /dev/sda2</p>
<pre><code>mke2fs 1.45.5 (07-Jan-2020)
Creating filesystem with 17825792 4k blocks and 4456448 inodes
Filesystem UUID: 78ab6377-d48b-4e4e-bd45-765505f600dd
Superblock backups stored on blocks:
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
	4096000, 7962624, 11239424

Allocating group tables: done
Writing inode tables: done
Creating journal (131072 blocks): done
Writing superblocks and filesystem accounting information: done
</code></pre>
<p>###dbuddenbaum@arm64-worker-04:~$**</p>
<p>sudo mkdir /mnt/ssd</p>
<p>###dbuddenbaum@arm64-worker-04:~$**</p>
<p>sudo mount /dev/sdb1 /mnt/ssd</p>
<p>###dbuddenbaum@arm64-worker-04:~$**</p>
<p>sudo mkdir /mnt/var</p>
<p>###dbuddenbaum@arm64-worker-04:~$**</p>
<p>sudo mount /dev/sda2 /mnt/var</p>
<p>###buddenbaum@arm64-worker-04:~$**</p>
<p>sudo vi /etc/fstab</p>
<pre><code>UUID=7aa06485-7262-4bfb-beb2-db61fe70b3bf       /mnt/ssd       xfs     defaults        0       0
UUID=78ab6377-d48b-4e4e-bd45-765505f600dd       /var       ext4     defaults        0       2
</code></pre>
<p>###dbuddenbaum@arm64-worker-04:~$**</p>
<p>sudo rsync -aqxP /var/* /mnt/var</p>
<p>###dbuddenbaum@arm64-worker-04:~$**</p>
<p>sudo umount /mnt/var</p>
<p>sudo shutdown -r</p>
<h2><a id="old" href="#old" class="Permalink" aria-hidden="true" title="Permalink">#</a>Old</h2>
<p>sudo parted -l</p>
<p>###dbuddenbaum@arm64-worker-02:~$**</p>
<p>sudo parted /dev/sda</p>
<pre><code>GNU Parted 3.3
Using /dev/sda
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) mklabel gpt
Warning: The existing disk label on /dev/sda will be destroyed and all data on this disk will be lost. Do you want to continue?
Yes/No? yes
(parted) print
Model: APPLE HD D ST1000DM003 (scsi)
Disk /dev/sda: 1000GB
Sector size (logical/physical): 512B/4096B
Partition Table: gpt
Disk Flags:

Number  Start  End  Size  File system  Name  Flags

(parted) mkpart primary ext4 1MB 31.9GB
(parted) print
Model: APPLE HD D ST1000DM003 (scsi)
Disk /dev/sda: 1000GB
Sector size (logical/physical): 512B/4096B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name     Flags
 1      1049kB  31.9GB  31.9GB  ext4         primary

(parted) quit
Information: You may need to update /etc/fstab.
</code></pre>
<p>###dbuddenbaum@arm64-worker-02:~$**</p>
<p>sudo fdisk /dev/sda</p>
<pre><code>Welcome to fdisk (util-linux 2.34).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): n
Partition number (2-128, default 2):
First sector (62304256-1953525134, default 62304256):
Last sector, +/-sectors or +/-size{K,M,G,T,P} (62304256-1953525134, default 1953525134):

Created a new partition 2 of type 'Linux filesystem' and of size 901.8 GiB.

Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.
</code></pre>
<h2><a id="if-the-fstype-field-is-not-empty-there-is-a-filesystem-on-top-of-the-corresponding-device-in-this-case-you-can-use-sda-for-ceph-partitions" href="#if-the-fstype-field-is-not-empty-there-is-a-filesystem-on-top-of-the-corresponding-device-in-this-case-you-can-use-sda-for-ceph-partitions" class="Permalink" aria-hidden="true" title="Permalink">#</a>If the FSTYPE field is not empty, there is a filesystem on top of the corresponding device. In this case, you can use sda for Ceph partitions.</h2>
<p>###dbuddenbaum@arm64-worker-02:/var/lib$**</p>
<p>lsblk -f</p>
<pre><code>NAME        FSTYPE   LABEL       UUID                                 FSAVAIL FSUSE% MOUNTPOINT
loop0       squashfs                                                        0   100% /snap/core18/1990
loop1       squashfs                                                        0   100% /snap/core18/2002
loop2       squashfs                                                        0   100% /snap/lxd/19206
loop3       squashfs                                                        0   100% /snap/lxd/19648
loop4       squashfs                                                        0   100% /snap/snapd/11584
loop5       squashfs                                                        0   100% /snap/snapd/11408
sda
mmcblk0
├─mmcblk0p1 vfat     system-boot B726-57E2                             132.8M    47% /boot/firmware
└─mmcblk0p2 ext4     writable    483efb12-d682-4daf-9b34-6e2f774b56f7     10G    61% /
</code></pre>
<p>##Preparing the external SSD - Attach the SSD drive to the Raspberry Pi with USB. The SSD will probably show up as ‘/dev/sda’.</p>
<p>sudo mkfs.xfs /dev/sdb1 -f ( this will erase all contents of the SSD ).
sudo mkdir /mnt/ssd
sudo mount /dev/sdb1 /mnt/ssd</p>
<h3><a id="dbuddenbaum-amd64-06-sudo-vi-etc-fstab" href="#dbuddenbaum-amd64-06-sudo-vi-etc-fstab" class="Permalink" aria-hidden="true" title="Permalink">#</a>dbuddenbaum@amd64-06:~$** sudo vi /etc/fstab</h3>
<pre><code># /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;
# / was on /dev/sda5 during installation
UUID=d736fb02-8e7a-42ce-948b-2321a0691b0c /               ext4    errors=remount-ro 0       1
# /boot/efi was on /dev/sda1 during installation
UUID=EA10-B595  /boot/efi       vfat    umask=0077      0       1
/dev/sdb1        /mnt/ssd       xfs     defaults        0       0
##/swapfile                                 none            swap    sw              0       0
</code></pre>
<h2><a id="disk-clean-up" href="#disk-clean-up" class="Permalink" aria-hidden="true" title="Permalink">#</a>disk clean up</h2>
<p>###dbuddenbaum@arm64-worker-02:~$**</p>
<p>DISK=“/dev/sda“</p>
<p>###dbuddenbaum@arm64-worker-02:~$**</p>
<p>sudo sgdisk –zap-all $DISK</p>
<pre><code>GPT data structures destroyed! You may now partition the disk using fdisk or
other utilities.
</code></pre>
<p>###dbuddenbaum@arm64-worker-02:/var/lib$**</p>
<p>sudo dd if=/dev/zero of=“$DISK“ bs=1M count=100 oflag=direct,dsync</p>
<pre><code>100+0 records in
100+0 records out
104857600 bytes (105 MB, 100 MiB) copied, 6.19267 s, 16.9 MB/s
</code></pre>
<p>dbuddenbaum@arm64-worker-02:/var/lib$ rm -rf /dev/ceph-*
dbuddenbaum@arm64-worker-02:/var/lib$ rm -rf /dev/mapper/ceph–*</p>
<h2><a id="rook-ceph" href="#rook-ceph" class="Permalink" aria-hidden="true" title="Permalink">#</a>Rook/Ceph</h2>
<p><a href="https://d-heinrich.medium.com/how-to-deploy-rook-with-ceph-in-kubernetes-baa5a9183830" class="Link--external" rel="noopener noreferrer">How to deploy ROOK with CEPH in Kubernetes</a></p>
<p><a href="https://cloudopsofficial.medium.com/the-ultimate-rook-and-ceph-survival-guide-eff198a5764a" class="Link--external" rel="noopener noreferrer">The Ultimate Rook and Ceph Survival Guide</a></p>
<p><a href="https://medium.com/swlh/build-ceph-and-kubernetes-based-distributed-file-storage-system-943da3dd0d24" class="Link--external" rel="noopener noreferrer">Build Ceph and Kubernetes Based Distributed File Storage System</a></p>
<p><a href="https://rook.github.io/docs/rook/master/ceph-quickstart.html" class="Link--external" rel="noopener noreferrer">Quick Start</a></p>
<p><a href="https://rook.io/docs/rook/v1.6/ceph-object.html" class="Link--external" rel="noopener noreferrer">Rook Documentation</a></p>
<p><a href="https://github.com/rook/rook/tree/release-1.6/cluster/examples/kubernetes/ceph" class="Link--external" rel="noopener noreferrer">cluster.yaml v1.6 Example</a></p>
<p><a href="https://github.com/rook/rook/branches" class="Link--external" rel="noopener noreferrer">https://github.com/rook/rook/branches</a></p>
<p><a href="https://github.com/rook/rook/tree/release-1.6" class="Link--external" rel="noopener noreferrer">https://github.com/rook/rook/tree/release-1.6</a></p>
<p><strong>#( 04/23/21@ 1:28PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl create -f crds.yaml</p>
<pre><code>customresourcedefinition.apiextensions.k8s.io/cephblockpools.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephclients.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephclusters.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephfilesystemmirrors.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephfilesystems.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephnfses.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephobjectrealms.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephobjectstores.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephobjectstoreusers.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephobjectzonegroups.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephobjectzones.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/cephrbdmirrors.ceph.rook.io created
customresourcedefinition.apiextensions.k8s.io/objectbucketclaims.objectbucket.io created
customresourcedefinition.apiextensions.k8s.io/objectbuckets.objectbucket.io created
customresourcedefinition.apiextensions.k8s.io/volumereplicationclasses.replication.storage.openshift.io created
customresourcedefinition.apiextensions.k8s.io/volumereplications.replication.storage.openshift.io created
customresourcedefinition.apiextensions.k8s.io/volumes.rook.io created
</code></pre>
<p><strong>#( 04/23/21@12:51PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl create -f common.yaml</p>
<pre><code>namespace/rook-ceph created
clusterrolebinding.rbac.authorization.k8s.io/rook-ceph-object-bucket created
serviceaccount/rook-ceph-admission-controller created
clusterrole.rbac.authorization.k8s.io/rook-ceph-admission-controller-role created
clusterrolebinding.rbac.authorization.k8s.io/rook-ceph-admission-controller-rolebinding created
clusterrole.rbac.authorization.k8s.io/rook-ceph-cluster-mgmt created
role.rbac.authorization.k8s.io/rook-ceph-system created
clusterrole.rbac.authorization.k8s.io/rook-ceph-global created
clusterrole.rbac.authorization.k8s.io/rook-ceph-mgr-cluster created
clusterrole.rbac.authorization.k8s.io/rook-ceph-object-bucket created
serviceaccount/rook-ceph-system created
rolebinding.rbac.authorization.k8s.io/rook-ceph-system created
clusterrolebinding.rbac.authorization.k8s.io/rook-ceph-global created
serviceaccount/rook-ceph-osd created
serviceaccount/rook-ceph-mgr created
serviceaccount/rook-ceph-cmd-reporter created
role.rbac.authorization.k8s.io/rook-ceph-osd created
clusterrole.rbac.authorization.k8s.io/rook-ceph-osd created
clusterrole.rbac.authorization.k8s.io/rook-ceph-mgr-system created
role.rbac.authorization.k8s.io/rook-ceph-mgr created
role.rbac.authorization.k8s.io/rook-ceph-cmd-reporter created
rolebinding.rbac.authorization.k8s.io/rook-ceph-cluster-mgmt created
rolebinding.rbac.authorization.k8s.io/rook-ceph-osd created
rolebinding.rbac.authorization.k8s.io/rook-ceph-mgr created
rolebinding.rbac.authorization.k8s.io/rook-ceph-mgr-system created
clusterrolebinding.rbac.authorization.k8s.io/rook-ceph-mgr-cluster created
clusterrolebinding.rbac.authorization.k8s.io/rook-ceph-osd created
rolebinding.rbac.authorization.k8s.io/rook-ceph-cmd-reporter created
podsecuritypolicy.policy/00-rook-privileged created
clusterrole.rbac.authorization.k8s.io/psp:rook created
clusterrolebinding.rbac.authorization.k8s.io/rook-ceph-system-psp created
rolebinding.rbac.authorization.k8s.io/rook-ceph-default-psp created
rolebinding.rbac.authorization.k8s.io/rook-ceph-osd-psp created
rolebinding.rbac.authorization.k8s.io/rook-ceph-mgr-psp created
rolebinding.rbac.authorization.k8s.io/rook-ceph-cmd-reporter-psp created
serviceaccount/rook-csi-cephfs-plugin-sa created
serviceaccount/rook-csi-cephfs-provisioner-sa created
role.rbac.authorization.k8s.io/cephfs-external-provisioner-cfg created
rolebinding.rbac.authorization.k8s.io/cephfs-csi-provisioner-role-cfg created
clusterrole.rbac.authorization.k8s.io/cephfs-csi-nodeplugin created
clusterrole.rbac.authorization.k8s.io/cephfs-external-provisioner-runner created
clusterrolebinding.rbac.authorization.k8s.io/rook-csi-cephfs-plugin-sa-psp created
clusterrolebinding.rbac.authorization.k8s.io/rook-csi-cephfs-provisioner-sa-psp created
clusterrolebinding.rbac.authorization.k8s.io/cephfs-csi-nodeplugin created
clusterrolebinding.rbac.authorization.k8s.io/cephfs-csi-provisioner-role created
serviceaccount/rook-csi-rbd-plugin-sa created
serviceaccount/rook-csi-rbd-provisioner-sa created
role.rbac.authorization.k8s.io/rbd-external-provisioner-cfg created
rolebinding.rbac.authorization.k8s.io/rbd-csi-provisioner-role-cfg created
clusterrole.rbac.authorization.k8s.io/rbd-csi-nodeplugin created
clusterrole.rbac.authorization.k8s.io/rbd-external-provisioner-runner created
clusterrolebinding.rbac.authorization.k8s.io/rook-csi-rbd-plugin-sa-psp created
clusterrolebinding.rbac.authorization.k8s.io/rook-csi-rbd-provisioner-sa-psp created
clusterrolebinding.rbac.authorization.k8s.io/rbd-csi-nodeplugin created
clusterrolebinding.rbac.authorization.k8s.io/rbd-csi-provisioner-role created
</code></pre>
<p><strong>#( 04/23/21@12:52PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl create -f operator.yaml</p>
<pre><code>configmap/rook-ceph-operator-config created
deployment.apps/rook-ceph-operator created
</code></pre>
<p><strong>#( 04/27/21@11:33AM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl -n rook-ceph get pod</p>
<pre><code>NAME                                  READY   STATUS    RESTARTS   AGE
rook-ceph-operator-855f844cf4-hdltl   1/1     Running   0          58s
rook-discover-8vq5g                   1/1     Running   0          56s
rook-discover-hlbj2                   1/1     Running   0          56s
rook-discover-ktmgk                   1/1     Running   0          57s
rook-discover-n28xn                   1/1     Running   0          57s
rook-discover-nmtft                   1/1     Running   0          56s
rook-discover-pczgp                   1/1     Running   0          56s
rook-discover-ph5cc                   1/1     Running   0          56s
rook-discover-vlz89                   1/1     Running   0          57s
rook-discover-zdqzd                   1/1     Running   0          56s
</code></pre>
<p><strong>#( 04/23/21@ 1:31PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl create -f cluster.yaml</p>
<pre><code>cephcluster.ceph.rook.io/rook-ceph created
</code></pre>
<p><strong>#( 04/23/21@ 3:33PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl create -f toolbox.yaml</p>
<pre><code>deployment.apps/rook-ceph-tools created
</code></pre>
<h2><a id="rook-tools" href="#rook-tools" class="Permalink" aria-hidden="true" title="Permalink">#</a>Rook Tools</h2>
<p><strong>[root@rook-ceph-tools-5b4b587f6b-f6kxc /]#</strong></p>
<p>ceph status</p>
<pre><code>   cluster:
     id:     4540e5a9-4563-4bc7-95da-1494b6a32132
     health: HEALTH_WARN
             mons are allowing insecure global_id reclaim
  
   services:
     mon: 3 daemons, quorum a,b,c (age 3m)
     mgr: a(active, since 101s)
     osd: 8 osds: 8 up (since 2m), 8 in (since 2m)
  
   data:
     pools:   1 pools, 1 pgs
     objects: 3 objects, 0 B
     usage:   8.0 GiB used, 5.7 TiB / 5.7 TiB avail
     pgs:     1 active+clean
</code></pre>
<p><strong>[root@rook-ceph-tools-5b4b587f6b-f6kxc /]#</strong></p>
<p>ceph health detail</p>
<pre><code>HEALTH_WARN mons are allowing insecure global_id reclaim; Reduced data availability: 1 pg inactive; OSD count 0 &lt; osd_pool_default_size 3
[WRN] AUTH_INSECURE_GLOBAL_ID_RECLAIM_ALLOWED: mons are allowing insecure global_id reclaim
    mon.a has auth_allow_insecure_global_id_reclaim set to true
    mon.b has auth_allow_insecure_global_id_reclaim set to true
    mon.c has auth_allow_insecure_global_id_reclaim set to true
[WRN] PG_AVAILABILITY: Reduced data availability: 1 pg inactive
    pg 1.0 is stuck inactive for 100m, current state unknown, last acting []
[WRN] TOO_FEW_OSDS: OSD count 0 &lt; osd_pool_default_size 3
</code></pre>
<p><strong>[root@rook-ceph-tools-5b4b587f6b-f6kxc /]#</strong></p>
<p>ceph osd status</p>
<pre><code>ID  HOST              USED  AVAIL  WR OPS  WR DATA  RD OPS  RD DATA  STATE      
 0  arm64-worker-03  1027M   900G      0        0       0        0   exists,up  
 1  amd64-05         1027M   434G      0        0       0        0   exists,up  
 2  amd64-03         1027M   434G      0        0       0        0   exists,up  
 3  amd64-04         1027M   434G      0        0       0        0   exists,up  
 4  amd64-02         1027M   900G      0        0       0        0   exists,up  
 5  arm64-master-01  1027M   900G      0        0       0        0   exists,up  
 6  arm64-worker-02  1027M   900G      0        0       0        0   exists,up  
 7  arm64-worker-04  1027M   900G      0        0       0        0   exists,up 

</code></pre>
<p><strong>[root@rook-ceph-tools-5b4b587f6b-f6kxc /]#</strong></p>
<p>ceph osd pool ls detail</p>
<pre><code>pool 1 'device_health_metrics' replicated size 3 min_size 2 crush_rule 0 object_hash rjenkins pg_num 1 pgp_num 1 autoscale_mode on last_change 29 flags hashpspool stripe_width 0 pg_num_min 1 application mgr_devicehealth```
</code></pre>
<p><strong>[root@rook-ceph-tools-5b4b587f6b-f6kxc /]#</strong></p>
<p>rados df</p>
<pre><code>POOL_NAME              USED  OBJECTS  CLONES  COPIES  MISSING_ON_PRIMARY  UNFOUND  DEGRADED  RD_OPS   RD  WR_OPS      WR  USED COMPR  UNDER COMPR
device_health_metrics   0 B        3       0       9                   0        0         0       0  0 B       3  58 KiB         0 B          0 B

total_objects    3
total_used       8.0 GiB
total_avail      5.7 TiB
total_space      5.7 TiB
</code></pre>
<pre><code>
ceph status
ceph osd tree
ceph osd status
ceph osd df
ceph osd utilization

</code></pre>
<p>##Dashboard</p>
<p><strong>#( 04/23/21@ 4:14PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl create -f dashboard-loadbalancer.yaml</p>
<pre><code>service/rook-ceph-mgr-dashboard-loadbalancer created
</code></pre>
<p><strong>#( 04/23/21@ 4:30PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl -n rook-ceph get service</p>
<pre><code>NAME                                   TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)             AGE
csi-cephfsplugin-metrics               ClusterIP      10.100.195.171   &lt;none&gt;         8080/TCP,8081/TCP   170m
csi-rbdplugin-metrics                  ClusterIP      10.108.25.77     &lt;none&gt;         8080/TCP,8081/TCP   170m
rook-ceph-mgr                          ClusterIP      10.108.34.158    &lt;none&gt;         9283/TCP            151m
rook-ceph-mgr-dashboard                ClusterIP      10.96.193.144    &lt;none&gt;         8443/TCP            151m
rook-ceph-mgr-dashboard-loadbalancer   LoadBalancer   10.104.104.117   192.168.2.16   8443:30942/TCP      12m
rook-ceph-mon-a                        ClusterIP      10.96.20.22      &lt;none&gt;         6789/TCP,3300/TCP   153m
rook-ceph-mon-b                        ClusterIP      10.107.3.18      &lt;none&gt;         6789/TCP,3300/TCP   151m
rook-ceph-mon-c                        ClusterIP      10.107.168.135   &lt;none&gt;         6789/TCP,3300/TCP   151m
rook-ceph-rgw-my-store                 ClusterIP      10.98.124.217    &lt;none&gt;         80/TCP              19m
</code></pre>
<p>Login Credentials</p>
<p>After you connect to the dashboard you will need to login for secure access. Rook creates a default user named <strong><em>admin</em></strong> and generates a secret called rook-ceph-dashboard-admin-password in the namespace where the Rook Ceph cluster is running. To retrieve the generated password, you can run the following:</p>
<p><strong>#( 04/23/21@ 4:24PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl -n rook-ceph get secret rook-ceph-dashboard-password -o jsonpath=“{[‘data’][‘password’]}“ | base64 –decode &amp;&amp; echo</p>
<pre><code>y.lkHZmMQbH7'VM-&gt;J$_
</code></pre>
<p><a href="https://192.168.2.16:8443/#/login?returnUrl=%2Fdashboard" class="Link--external" rel="noopener noreferrer">ceph dashboard</a></p>
<h2><a id="crd-deletion-gets-stuck" href="#crd-deletion-gets-stuck" class="Permalink" aria-hidden="true" title="Permalink">#</a>CRD Deletion gets stuck</h2>
<p><strong>#( 04/24/21@ 6:09PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl patch crd/cephclusters.ceph.rook.io -p ‘{“metadata”:{“finalizers”:[]}}’ –type=merge</p>
<p><code>customresourcedefinition.apiextensions.k8s.io/cephclusters.ceph.rook.io patched</code></p>
<p><strong>#( 04/24/21@ 6:15PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl patch crd/cephobjectstores.ceph.rook.io -p ‘{“metadata”:{“finalizers”:[]}}’ –type=merge</p>
<p><code>customresourcedefinition.apiextensions.k8s.io/cephobjectstores.ceph.rook.io patched</code></p>
<p><strong>#( 04/24/21@ 6:16PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl patch crd/cephobjectstoreusers.ceph.rook.io -p ‘{“metadata”:{“finalizers”:[]}}’ –type=merge</p>
<p><code>customresourcedefinition.apiextensions.k8s.io/cephobjectstoreusers.ceph.rook.io patched</code></p>
<h2><a id="remove-storage-host-based-cluster" href="#remove-storage-host-based-cluster" class="Permalink" aria-hidden="true" title="Permalink">#</a>Remove storage Host-based cluster</h2>
<p><a href="https://github.com/rook/rook/blob/master/Documentation/ceph-osd-mgmt.md" class="Link--external" rel="noopener noreferrer">Ceph OSD Management</a></p>
<p>Update your CephCluster CR. Depending on your CR settings, you may need to remove the device from the list or update the device filter. If you are using useAllDevices: true, no change to the CR is necessary.</p>
<p><strong><em>IMPORTANT:</em></strong> On host-based clusters, you may need to stop the Rook Operator while performing OSD removal steps in order to prevent Rook from detecting the old OSD and trying to re-create it before the disk is wiped or removed.</p>
<h3><a id="to-stop-the-rook-operator-run" href="#to-stop-the-rook-operator-run" class="Permalink" aria-hidden="true" title="Permalink">#</a>To stop the Rook Operator, run</h3>
<pre><code>kubectl -n rook-ceph scale deployment rook-ceph-operator --replicas=0
</code></pre>
<p><strong><em>IMPORTANT:</em></strong> You must perform steps below to</p>
<ul>
<li>(1) purge the OSD and either (2.a) delete the underlying data</li>
<li>(2.b)replace the disk before starting the Rook Operator again.</li>
</ul>
<h3><a id="start-the-rook-operator-run" href="#start-the-rook-operator-run" class="Permalink" aria-hidden="true" title="Permalink">#</a>Start the Rook operator run:</h3>
<pre><code> kubectl -n rook-ceph scale deployment rook-ceph-operator --replicas=1.
</code></pre>
<h3><a id="purge-the-osd-from-the-ceph-cluster" href="#purge-the-osd-from-the-ceph-cluster" class="Permalink" aria-hidden="true" title="Permalink">#</a>Purge the OSD from the Ceph cluster</h3>
<p>OSD removal can be automated with the example found in the [rook-ceph-purge-osd job](<a href="https://github.com/rook/rook/blob/" class="Link--external" rel="noopener noreferrer">https://github.com/rook/rook/blob/</a>{{ branchName }}/cluster/examples/kubernetes/ceph/osd-purge.yaml).</p>
<p><strong><em>IMPORTANT:</em></strong> In the osd-purge.yaml, change the <strong>&lt;OSD-IDs&gt;</strong> to the ID(s) of the OSDs you want to remove.</p>
<ul>
<li>Run the job: kubectl create -f osd-purge.yaml</li>
<li>When the job is completed, review the logs to ensure success: kubectl -n rook-ceph logs -l app=rook-ceph-purge-osd</li>
<li>When finished, you can delete the job: kubectl delete -f osd-purge.yaml</li>
</ul>
<p>If you want to remove OSDs by hand, continue with the following sections. However, we recommend you to use the above-mentioned job to avoid operation errors.</p>
<h3><a id="remove-the-osd" href="#remove-the-osd" class="Permalink" aria-hidden="true" title="Permalink">#</a>Remove the OSD</h3>
<ul>
<li>kubectl -n rook-ceph scale deployment rook-ceph-operator –replicas=0</li>
<li>kubectl -n rook-ceph scale deployment rook-ceph-osd-&lt;ID&gt; –replicas=0</li>
<li>kubectl create -f osd-purge.yaml</li>
<li>kubectl -n rook-ceph logs -l app=rook-ceph-purge-osd</li>
<li>kubectl delete -f osd-purge.yaml</li>
<li>kubectl delete deployment -n rook-ceph rook-ceph-osd-&lt;ID&gt;</li>
<li>kubectl -n rook-ceph scale deployment rook-ceph-operator –replicas=1</li>
</ul>
<h3><a id="replace-an-osd" href="#replace-an-osd" class="Permalink" aria-hidden="true" title="Permalink">#</a>Replace an OSD</h3>
<p>To replace a disk that has failed:</p>
<ul>
<li>Run the steps in the previous section to Remove an OSD.</li>
<li>Replace the physical device and verify the new device is attached.</li>
<li>Check if your cluster CR will find the new device. If you are using useAllDevices: true you can skip this step. If your cluster CR lists individual devices or uses a device filter you may need to update the CR.</li>
<li>The operator ideally will automatically create the new OSD within a few minutes of adding the new device or updating the CR. If you don’t see a new OSD automatically created, restart the operator (by deleting the operator pod) to trigger the OSD creation.</li>
<li>Verify if the OSD is created on the node by running ceph osd tree from the toolbox.</li>
</ul>
<p>Note that the OSD might have a different ID than the previous OSD that was replaced.</p>
<h2><a id="block-storage" href="#block-storage" class="Permalink" aria-hidden="true" title="Permalink">#</a>Block Storage</h2>
<p><a href="https://itnext.io/deploy-a-ceph-cluster-on-kubernetes-with-rook-d75a20c3f5b1" class="Link--external" rel="noopener noreferrer">Get block storage from Ceph</a></p>
<p><strong>#( 05/02/21@ 5:24PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph@master✗✗✗</strong></p>
<p>kubectl apply -f ./rbd/storageclass.yaml</p>
<pre><code>cephblockpool.ceph.rook.io/replicapool created
storageclass.storage.k8s.io/rook-ceph-block created
</code></pre>
<p><strong>#( 05/02/21@ 5:29PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph/rbd@master✗✗✗</strong></p>
<pre><code>kubectl get pvc,pv
</code></pre>
<pre><code>NAME                              STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      AGE
persistentvolumeclaim/mongo-pvc   Bound    pvc-84409028-a00e-4936-bcf0-63ff36068893   5Gi        RWO            rook-ceph-block   32s

NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                              STORAGECLASS      REASON   AGE
persistentvolume/pvc-6396501d-8a0b-46aa-a576-a6218908683e   8Gi        RWO            Delete           Bound    monitor/prometheus-server          nfs-ssd1                   131d
persistentvolume/pvc-786f572c-e95c-4556-839a-5081bfe1a0af   2Gi        RWO            Delete           Bound    monitor/prometheus-alertmanager    nfs-ssd1                   131d
persistentvolume/pvc-84409028-a00e-4936-bcf0-63ff36068893   5Gi        RWO            Delete           Bound    amd64default/mongo-pvc             rook-ceph-block            29s
persistentvolume/pvc-f5ddda65-eeef-41c3-b9c4-da2715b5ac33   1Gi        RWO            Delete           Bound    community-grid/rosettaathomedata   nfs-ssd1                   48d
</code></pre>
<h2><a id="deploy-mongodb-community-edition-on-ceph-block-storage" href="#deploy-mongodb-community-edition-on-ceph-block-storage" class="Permalink" aria-hidden="true" title="Permalink">#</a>Deploy MongoDB Community Edition on CEPH block storage</h2>
<p><strong>#( 05/02/21@ 5:54PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph/rbd@master✗✗✗</strong></p>
<p>kubectl apply -f mongo.yaml</p>
<pre><code>deployment.apps/mongo created
service/mongo created

</code></pre>
<p><strong>#( 05/02/21@ 5:54PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph/rbd@master✗✗✗</strong></p>
<pre><code>kubectl get pods,svc
</code></pre>
<pre><code>NAME                         READY   STATUS    RESTARTS   AGE
pod/bear-67fd7744bf-f6t9f    1/1     Running   1          4d23h
pod/hare-5446fcff89-jb5zx    1/1     Running   0          4d23h
pod/mongo-5d7ff54f7d-qh67w   1/1     Running   0          32s
pod/moose-57b7db48cb-mx7jc   1/1     Running   1          4d23h

NAME            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)           AGE
service/bear    ClusterIP   10.105.36.211    &lt;none&gt;        80/TCP            20d
service/hare    ClusterIP   10.101.99.44     &lt;none&gt;        80/TCP            20d
service/mongo   NodePort    10.100.234.50    &lt;none&gt;        27017:31017/TCP   31s
service/moose   ClusterIP   10.108.246.110   &lt;none&gt;        80/TCP            20d
</code></pre>
<p><strong>#( 05/02/21@ 5:55PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph/rbd@master✗✗✗</strong></p>
<p>kubectl get pods  -o wide</p>
<pre><code>NAME                     READY   STATUS    RESTARTS   AGE     IP              NODE       NOMINATED NODE   READINESS GATES
bear-67fd7744bf-f6t9f    1/1     Running   1          4d23h   10.244.0.104    amd64-02   &lt;none&gt;           &lt;none&gt;
hare-5446fcff89-jb5zx    1/1     Running   0          4d23h   10.244.0.99     amd64-02   &lt;none&gt;           &lt;none&gt;
mongo-5d7ff54f7d-qh67w   1/1     Running   0          9m28s   10.244.12.121   amd64-06   &lt;none&gt;           &lt;none&gt;
moose-57b7db48cb-mx7jc   1/1     Running   1          4d23h   10.244.0.96     amd64-02   &lt;none&gt;           &lt;none&gt;
</code></pre>
<p><strong>#( 05/02/21@ 5:54PM )( dbuddenbaum@dbuddenbaum-mbp ):~/Documents/rPi4/kalaxy/yaml/rook-ceph/rbd@master✗✗✗</strong></p>
<p>kubectl get nodes -o wide</p>
<pre><code>NAME              STATUS   ROLES    AGE    VERSION    INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME
amd64-02          Ready    master   188d   v1.17.11   192.168.2.56   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-72-generic   docker://19.3.12
amd64-03          Ready    &lt;none&gt;   188d   v1.17.11   192.168.2.57   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-72-generic   docker://19.3.12
amd64-04          Ready    &lt;none&gt;   180d   v1.17.11   192.168.2.58   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-72-generic   docker://19.3.12
amd64-05          Ready    &lt;none&gt;   158d   v1.17.11   192.168.2.59   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-72-generic   docker://19.3.12
amd64-06          Ready    &lt;none&gt;   50d    v1.17.11   192.168.2.60   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-72-generic   docker://19.3.12
arm64-master-01   Ready    &lt;none&gt;   69d    v1.17.11   192.168.2.50   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-1034-raspi   docker://19.3.12
arm64-worker-02   Ready    &lt;none&gt;   69d    v1.17.11   192.168.2.52   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-1034-raspi   docker://19.3.12
arm64-worker-03   Ready    &lt;none&gt;   84d    v1.17.11   192.168.2.53   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-1034-raspi   docker://19.3.12
arm64-worker-04   Ready    &lt;none&gt;   69d    v1.17.11   192.168.2.54   &lt;none&gt;        Ubuntu 20.04.2 LTS   5.4.0-1034-raspi   docker://19.3.12
</code></pre>
<p>MongoDB Compass 192.168.2.60:31017</p>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../file_system/backup.html">Previous</a></li>            <li class=Pager--next><a href="../file_system/crd.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- JS -->
            <script src="../themes/daux/js/main.mjs"></script>
    
        <script>
        
        window.searchLanguage = "";
        window.searchTranslation = {"Search_one_result":"1 result","Search_results":"!count results","Search_no_results":"Nothing found","Search_common_words_ignored":"Common words are largely ignored","Search_too_short":"Search too short","Search_one_character_or_more":"Should be one character or more","Search_should_be_x_or_more":"Should be !min characters or more","Link_previous":"Previous","Link_next":"Next"};
    </script>

    <!-- Search -->
    <script type="text/javascript" src="../daux_libraries/search.min.js"></script>

    <script>
        window.search({'base_url': '../'})
    </script>
</body>
</html>
